<link rel="import" href="/sys/moment-element/moment-element.html">
<link rel="stylesheet" href="/sys/Stylesheet1.css">

<template>
    <template is="dom-bind">
		<div>[[processInit(model.Html)]]</div>

		<!--<div style="width:100%;overflow:hidden;box-sizing:border-box">-->
		<!--<table  id="tblOphs" style="table-layout:fixed;font-family:Arial, Helvetica, sans-serif;font-size:small" onclick="tmplt.MyFnc(event, this)">-->
		<!--<table id="tblOphs" style="table-layout:auto;font-family:Arial, Helvetica, sans-serif;font-size:small" on-click="MyFnc"  dene="[[processInit(model.Html)]]">-->
        <div style="height: calc(100vh - 76px); width: 100vw; overflow: auto;">
            <table id="tblOphs" style="table-layout:auto;font-family:Arial, Helvetica, sans-serif;font-size:small" on-click="MyFnc">
                <!--<table id="tblOphs" class="print t1" on-click="MyFnc">-->
                <thead>
                    <tr>
                        <th id="OphID" data-tooltip$="[[model.OphID]]">ID</th>
                        <th id="EXD_t" data-tooltip$="[[model.EXD_t]]">EXD</th>
                        
                        <th id="ROT" data-tooltip$="[[model.ROT]]">R</th>
                        <th id="MOT" data-tooltip$="[[model.MOT]]">M</th>
                        
                        <th id="Org" data-tooltip$="[[model.Org]]">Org</th>
                        <th id="Dst" data-tooltip$="[[model.Dst]]">Dst</th>
                        
                        <th id="nStu" data-tooltip$="[[model.nStu]]">Statu</th>
                        <th id="nStuTS_t" data-tooltip$="[[model.nStuTS_t]]"></th>
                        <th id="pStu" data-tooltip$="[[model.pStu]]">Problem</th>
                        <th id="pStuTS_t" data-tooltip$="[[model.pStuTS_t]]"></th>

                        <th id="ShpAd" abbr="frm" data-tooltip$="[[model.ShpAd]]">Shp</th>
                        <th id="CneAd" abbr="frm" data-tooltip$="[[model.CneAd]]">Cne</th>
                        <th id="AccAd" abbr="frm" data-tooltip$="[[model.AccAd]]">Acc</th>
                        <th id="MnfAd" abbr="frm" data-tooltip$="[[model.MnfAd]]">Mnf</th>
                        <th id="NfyAd" abbr="frm" data-tooltip$="[[model.NfyAd]]">Ntf</th>

                        <th id="NOP" data-tooltip$="[[model.NOP]]">NOP</th>
                        <th id="GrW" data-tooltip$="[[model.GrW]]">GrW</th>
                        <th id="VM3" data-tooltip$="[[model.VM3]]">VM3</th>
                        <th id="ChW" data-tooltip$="[[model.ChW]]">ChW</th>

                        <th id="DTM" data-tooltip$="[[model.DTM]]">DTM</th>
                        <th id="PTM" data-tooltip$="[[model.PTM]]">PTM</th>

                        <th id="ROH_t" data-tooltip$="[[model.ROH_t]]">ROH</th>
                        <th id="EOH_t" data-tooltip$="[[model.EOH_t]]">EOH</th>
                        <th id="REOH_t" data-tooltip$="[[model.REOH_t]]">REOH</th>
                        <th id="AOH_t" data-tooltip$="[[model.AOH_t]]">AOH</th>
                        <th id="RTR_t" data-tooltip$="[[model.RTR_t]]">RTR</th>
                        <th id="ROS_t" data-tooltip$="[[model.ROS_t]]">ROS</th>
                        <th id="POD_t" data-tooltip$="[[model.POD_t]]">POD</th>
                        
                        <th id="ETD_t" data-tooltip$="[[model.ETD_t]]">ETD</th>
                        <th id="ATD_t" data-tooltip$="[[model.ATD_t]]">ATD</th>
                        <th id="ETA_t" data-tooltip$="[[model.ETA_t]]">ETA</th>
                        <th id="ATA_t" data-tooltip$="[[model.ATA_t]]">ATA</th>
                        
                        <th id="ACOT_t" data-tooltip$="[[model.ACOT_t]]">ACOT</th>
                        <th id="DRBD_t" data-tooltip$="[[model.DRBD_t]]">DRBD</th>
                        <th id="TPAD_t" data-tooltip$="[[model.TPAD_t]]">TPAD</th>
                        <th id="TPDD_t" data-tooltip$="[[model.TPDD_t]]">TPDD</th>
                        
                        <th id="CntNoS" data-tooltip$="[[model.CntNoS]]">Cnt#</th>
                    </tr>
                </thead>
                <tbody>
                    <template is="dom-repeat" items="[[abcd]]">
                        <tr>
                            <td>[[item.OphID]]</td>
                            <!--<td style="max-width: 200px;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;">[[item.EXD]]</td>-->
                            <td><moment-element datetime="[[item.EXD_t]]" output-format="DD.MM.YY"></moment-element></td>
                            <td>[[item.ROT]]</td>
                            <td>[[item.MOT]]</td>
                            <td>[[item.Org]]</td>
                            <td>[[item.Dst]]</td>
                            <td>[[item.nStuAd]]</td>
                            <td class="trh"><moment-element datetime="[[item.nStuTS_t]]" output-format="DD.MM.YY"></moment-element></td>
                            <td>[[item.pStu]]</td>
                            <td>[[item.pStuD]]</td>

                            <td>[[item.ShpAd]]</td>
                            <td>[[item.CneAd]]</td>
                            <td>[[item.AccAd]]</td>
                            <td>[[item.MnfAd]]</td>
                            <td>[[item.NfyAd]]</td>

                            <td>[[item.NOP]]</td>
                            <td>[[item.GrW]]</td>
                            <td>[[item.VM3]]</td>
                            <td>[[item.ChW]]</td>

                            <td>[[item.DTM]]</td>
                            <td>[[item.PTM]]</td>

                            <td class="trh"><moment-element datetime="[[item.ROH_t]]" output-format="DD.MM.YY"></moment-element></td>
                            <td class="trh"><moment-element datetime="[[item.EOH_t]]" output-format="DD.MM.YY"></moment-element></td>
                            <td class="trh"><moment-element datetime="[[item.REOH_t]]" output-format="DD.MM.YY"></moment-element></td>
                            <td class="trh"><moment-element datetime="[[item.AOH_t]]" output-format="DD.MM.YY"></moment-element></td>
                            <td class="trh"><moment-element datetime="[[item.RTR_t]]" output-format="DD.MM.YY"></moment-element></td>
                            <td class="trh"><moment-element datetime="[[item.ROS_t]]" output-format="DD.MM.YY"></moment-element></td>
                            <td class="trh"><moment-element datetime="[[item.POD_t]]" output-format="DD.MM.YY"></moment-element></td>
                            <td class="trh"><moment-element datetime="[[item.ETD_t]]" output-format="DD.MM.YY"></moment-element></td>
                            <td class="trh"><moment-element datetime="[[item.ATD_t]]" output-format="DD.MM.YY"></moment-element></td>
                            <td class="trh"><moment-element datetime="[[item.ETA_t]]" output-format="DD.MM.YY"></moment-element></td>
                            <td class="trh"><moment-element datetime="[[item.ATA_t]]" output-format="DD.MM.YY"></moment-element></td>
                            <td class="trh"><moment-element datetime="[[item.ACOT_t]]" output-format="DD.MM.YY"></moment-element></td>
                            <td class="trh"><moment-element datetime="[[item.DRBD_t]]" output-format="DD.MM.YY"></moment-element></td>
                            <td class="trh"><moment-element datetime="[[item.TPAD_t]]" output-format="DD.MM.YY"></moment-element></td>
                            <td class="trh"><moment-element datetime="[[item.TPDD_t]]" output-format="DD.MM.YY"></moment-element></td>
                            
                            <td>[[item.CntNoS]]</td>
                        </tr">
                    </template>
                </tbody>
            </table>
        </div>
    </template>
	
	<script>
		(function ()
		{
			var curRowIndex = -1;
			var curCellIndex = -1;

			var script = document._currentScript || document.currentScript;
			tmplt = script.previousElementSibling;

			tmplt.processInit = function (val) {
				//console.log("processInit this1", this.$.tblOphs);
				//console.log("processInit this2", this.$["EXD"]);
				if (curCellIndex != -1) {
					this.$.tblOphs.rows[0].cells[curCellIndex].classList.remove("curSort");
				}
				if (curRowIndex != -1) {
					this.$.tblOphs.rows[curRowIndex].classList.remove("curRow");
				}
				curRowIndex = -1;
				curCellIndex = -1;
				tmplt.abcd = JSON.parse(JSON.stringify(tmplt.model.Ophs));
				console.log("processInit", tmplt.abcd.length);

			};

			tmplt.MyFnc = function (e, x) {
				if (e.target.parentNode.rowIndex == 0)
				{
					console.log("target ID", e.target.id.substring(e.target.id.length - 2));
					if (curCellIndex != -1) {
						this.$.tblOphs.rows[0].cells[curCellIndex].classList.remove("curSort");
						//x.rows[0].cells[curCellIndex].classList.remove("curSort");
					}
					//console.log("TableMyFnc2", this);
					curCellIndex = e.target.cellIndex;
					e.target.classList.add("curSort");

					var sener = JSON.parse(JSON.stringify(tmplt.model.Ophs));
					//if (e.target.id.substring(e.target.id.length - 2) == "_t")
					if (e.target.id.endsWith("_t") || e.target.id.endsWith("ID"))
						tmplt.abcd = sener.sort(firstBy(e.target.id, -1));
					else
						tmplt.abcd = sener.sort(firstBy(e.target.id));
				}
				else
				{
					if (curRowIndex != -1) {
						this.$.tblOphs.rows[curRowIndex].classList.remove("curRow");
					}
					curRowIndex = e.target.parentNode.rowIndex;
					e.target.parentNode.classList.add("curRow");
				}
			}

		})();

	</script>

</template>
