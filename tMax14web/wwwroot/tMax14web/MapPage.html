<link rel="import" href="/sys/polymer/polymer.html">
<link rel="import" href="/sys/paper-dialog/paper-dialog.html">
<link rel="import" href="/sys/google-map/google-map.html">
<link rel="import" href="/sys/google-map/google-map-marker.html">

<template>
    <template is="dom-bind">
        
        <div class="map-grid">
            <div class="map-left">
                <div>Trackers</div>
                <ul>
                    <template is="dom-repeat" items="[[model.MapList]]">
                        <li>
                            <button value="{{item.Show$::click}}" onmousedown="++this.value">[[item.Title]] - [[item.Lat]] - [[item.Lon]]</button>
                        </li>

                    </template>
                </ul>
            </div>

            <div class="map-right">
                <google-map map={{map}}
                            style="height: calc(100vh - 74px);"
                            fit-to-markers
                            latitude="37.026835"
                            longitude="27.563807"
                            api-key="AIzaSyDPkEs-_HJWKejZ5qLXTmXXfVFnAXJmnt0">

                    <template is="dom-repeat" items="{{model.Markers}}">
                            <google-map-marker map="{{map}}"
                                               click-events
                                               on-google-map-marker-click="_markerClick"
                                               on-google-map-marker-open="_markerClick"
                                               on-google-map-marker-close="_markerClose"
                                               slot="markers"
                                               latitude="[[item.Lat]]"
                                               longitude="[[item.Lon]]"
                                               title="[[item.Title]]"
                                               open="{{item.ShowInfo$}}"
                                               >
                                -[[item.Info]]
                            </google-map-marker>
                    </template>
                </google-map>
            </div>
        </div>

    </template>
    <script>
        (function () {
            var script = document._currentScript || document.currentScript;
            tmplt = script.previousElementSibling;

            tmplt._markerClick = function (e) {
                // https://www.polymer-project.org/1.0/docs/devguide/templates
                //console.log("e.model.item.Info: " + e.model.item.Info); // Asagidakiyle ayni sonuc
                console.log("e.model.get('item.Info'): ", e.model.get('item.Info'));
                e.model.set('item.ShowInfo$', true);
                console.log(e.model.get('item.ShowInfo$'));

                //console.log(this.$.firstRepeat.modelForElement(e.target));

                // Hepsi ayni sonuc (e ye model'i koyan polymer)
                //e.target.innerHTML = e.model.__data__.item.Info;
                e.target.innerHTML = e.model.get('item.Info');
                //e.target.innerHTML = e.model.item.Info;
            }

            tmplt._markerClose = function (e) {
                e.model.set('item.ShowInfo$', false);
                console.log("_markerClose:", e.model.get('item.ShowInfo$'));
            }

        })();
    </script>
</template>